<!-- Document for a simple game in console -->
<!-- Everything will be in the script element -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Rock Paper Scissors</title>
  </head>
  <body>
    <script>
      /************************************************************************
       * OVERVIEW
       ***********************************************************************/
       /*
       - 1 player against the computer.
       - A move is chosen by the computer that the user can't see.
       - The user is prompted a choice that they'll enter as a string
         ('rock', 'paper', or 'scissors', case insensitive.)
       - Log a string announcing the result like "You Lose! Paper beats Rock"
       - Save the score
       - Make 5 rounds like that
       - Announce the winner like "You 3 - 2 CPU \n A WINNER IS YOU"
       */
      /************************************************************************
       * FUNCTIONS
       ***********************************************************************/

      // Returns a random integer in a range
      function getRandomInt(n) {
        return Math.floor(Math.random() * Math.floor(n));
      }

      // Returns randomly 'rock', 'paper' or 'scissors'
      function computerPlay() {
        let choice = getRandomInt(3);
        switch(choice) {
          case 0:
            choice = 'rock';
            break;
          case 1:
            choice = 'paper';
            break;
          case 2:
            choice = 'scissors';
            break;
          default:
            choice = 'rock';
        }
        return choice;
      }

      // Returns the user input for a selection
      function promptPlayerSelection() {
        return prompt('Please input "rock", "paper", or "scissors".', 'rock');
      }

      // Returns valid input string or undefined
      function cleanPlayerSelection(input) {
        let i = input.toLowerCase();
        if (i === 'rock' || i === 'paper' || i === 'scissors') {
          return i;
        } else {
          return undefined;
        }
      }

      // Returns the player's lowercased selection
      function getPlayerSelection() {
        let choice = cleanPlayerSelection(promptPlayerSelection());
        while(choice === undefined) {
          console.log("Please input a valid selection.")
          choice = cleanPlayerSelection(promptPlayerSelection());
        }
        return choice;
      }

      // Returns true if the player wins, false if it's the CPU, undefined if draw
      function evalRound(player, cpu) {
        if (player === 'rock' && cpu === 'scissors' ||
            player === 'paper' && cpu === 'rock' ||
            player === 'scissors' && cpu === 'paper') {
              return true;
        } else if(player === 'rock' && cpu === 'paper' ||
                  player === 'paper' && cpu === 'scissors' ||
                  player === 'scissors' && cpu === 'rock'){
          return false;
        } else {
          return undefined;
        }
      }

      // Plays a round of the game
      function playSingleRound(playerSelection, computerSelection) {
        playerSelection = getPlayerSelection();
        let playerWins = evalRound(playerSelection, computerSelection);
        if (playerWins === undefined) {
          console.log(`Draw: ${playerSelection} is ${computerSelection}`);
          return 'draw';
        } else if (playerWins) {
          console.log(`You win, ${playerSelection} beats ${computerSelection}`);
          return 'win';
        } else {
          console.log(`You lose, ${computerSelection} beats ${playerSelection}`);
          return 'lose';
        }
      }

      // Returns the result of the game
      function getFinalResults(playerScore, cpuScore) {
        if(playerScore > cpuScore) {
          return `You ${playerScore} - ${cpuScore} CPU -- A WINNER IS YOU`;
        } else if(cpuScore > playerScore) {
          return `You ${playerScore} - ${cpuScore} CPU -- A WINNER IS NOT YOU`;
        } else {
          return `You ${playerScore} - ${cpuScore} CPU -- DRAW`;
        }
      }

      /************************************************************************
       * GAME LOOP
       ***********************************************************************/
      function game() {
        let playerScore = 0;
        let cpuScore = 0;
        const numberOfRounds = 5;

        let roundResult = '';
        for(i = 0; i < numberOfRounds; i++) {
          roundResult = playSingleRound('', computerPlay());
          if(roundResult === 'win') {
            playerScore++;
          } else if(roundResult == 'lose') {
            cpuScore++;
          }
        }
        return getFinalResults(playerScore, cpuScore);
      }

    </script>
  </body>
</html>